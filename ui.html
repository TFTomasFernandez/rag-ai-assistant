<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>RAG Challenge UI</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #070d1b;
      color: #f9fafb;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 100vh;
    }

    .app {
      max-width: 900px;
      width: 100%;
      padding: 24px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: #0b1220;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.6);
      border: 1px solid #1f2937;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    h1 {
      font-size: 24px;
      margin: 0 0 4px 0;
    }

    .subtitle {
      font-size: 14px;
      color: #9ca3af;
    }

    .field-row {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }

    .field-row input {
      flex: 1;
      min-width: 140px;
    }

    label {
      font-size: 13px;
      color: #e5e7eb;
    }

    input[type="text"], textarea {
      background: #020617;
      border-radius: 10px;
      border: 1px solid #1f2937;
      padding: 8px 10px;
      color: #f9fafb;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
      outline: none;
    }

    input[type="text"]:focus,
    textarea:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px #38bdf8;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
      max-height: 180px;
    }

    .btn-row {
      display: flex;
      justify-content: flex-end;
      margin-top: 8px;
      gap: 8px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
      font-weight: 500;
    }

    .btn-primary {
      background: linear-gradient(to right, #38bdf8, #6366f1);
      color: #0b1120;
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: wait;
    }

    .btn-secondary {
      background: #111827;
      color: #e5e7eb;
      border: 1px solid #374151;
    }

    .messages {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 8px;
      max-height: 380px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .msg {
      padding: 10px 12px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.4;
      white-space: pre-wrap;
    }

    .msg-user {
      align-self: flex-end;
      background: #1d4ed8;
      color: #e5e7eb;
      border-bottom-right-radius: 4px;
    }

    .msg-bot {
      align-self: flex-start;
      background: #020617;
      border: 1px solid #1f2937;
      border-bottom-left-radius: 4px;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(56, 189, 248, 0.1);
      color: #7dd3fc;
      border: 1px solid rgba(56, 189, 248, 0.3);
    }

    .status {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-thumb {
      background: #1f2937;
      border-radius: 999px;
    }

  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;">
        <div>
          <h1>ðŸ“š RAG Stories Assistant</h1>
          <div class="subtitle">Preguntale a tu modelo RAG sobre los cuentos del PDF, en espaÃ±ol, inglÃ©s o portuguÃ©s.</div>
        </div>
        <div class="badge">
          <span>RAG Offline</span>
        </div>
      </div>

      <div class="field-row">
        <div style="flex:1;">
          <label for="userName">Nombre del usuario</label>
          <input id="userName" type="text" placeholder="Ej: TomÃ¡s" />
        </div>
      </div>

      <label for="questionInput" style="margin-top:8px;">Pregunta</label>
      <textarea id="questionInput" placeholder="EscribÃ­ tu pregunta sobre el documento..."></textarea>

      <div class="btn-row">
        <button class="btn-secondary" id="clearBtn" type="button">Limpiar chat</button>
        <button class="btn-primary" id="sendBtn" type="button">Preguntar</button>
      </div>

      <div class="status" id="statusText">Listo para responder âœ…</div>
    </div>

    <div class="card">
      <div class="subtitle" style="margin-bottom:4px;">ConversaciÃ³n</div>
      <div id="messages" class="messages"></div>
    </div>
  </div>

  <script>
    const userNameEl = document.getElementById('userName');
    const questionEl = document.getElementById('questionInput');
    const sendBtn = document.getElementById('sendBtn');
    const clearBtn = document.getElementById('clearBtn');
    const messagesEl = document.getElementById('messages');
    const statusEl = document.getElementById('statusText');

    function appendMessage(text, type) {
      const div = document.createElement('div');
      div.classList.add('msg');
      div.classList.add(type === 'user' ? 'msg-user' : 'msg-bot');
      div.textContent = text;
      messagesEl.appendChild(div);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    async function sendQuestion() {
      const userName = userNameEl.value.trim() || 'Usuario';
      const question = questionEl.value.trim();

      if (!question) return;

      appendMessage(question, 'user');
      questionEl.value = '';
      questionEl.focus();
      sendBtn.disabled = true;
      statusEl.textContent = 'Pensando... â³';

      try {
        const res = await fetch('/query', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            user_name: userName,
            question: question
          })
        });

        if (!res.ok) {
          appendMessage('Error al contactar la API âš ï¸', 'bot');
        } else {
          const data = await res.json();
          appendMessage(data.answer || '(Respuesta vacÃ­a)', 'bot');
        }
      } catch (err) {
        appendMessage('Error de conexiÃ³n con el servidor âš¡', 'bot');
      } finally {
        sendBtn.disabled = false;
        statusEl.textContent = 'Listo para responder âœ…';
      }
    }

    sendBtn.addEventListener('click', sendQuestion);

    questionEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendQuestion();
      }
    });

    clearBtn.addEventListener('click', () => {
      messagesEl.innerHTML = '';
    });
  </script>
</body>
</html>
